import numpy as np
import serial
import time

"""
song = [
    [   261, 261, 392, 392, 440, 440, 392,
        349, 349, 330, 330, 294, 294, 261,
        392, 392, 349, 349, 330, 330, 294,
        392, 392, 349, 349, 330, 330, 294,
        261, 261, 392, 392, 440, 440, 392,
        349, 349, 330, 330, 294, 294, 261 ],
    [   392, 329, 329, 349, 294, 294,
        261, 294, 329, 349, 392, 392, 392,
        392, 329, 329, 349, 294, 294,
        261, 329, 392, 392, 329 ],
    [   261, 294, 329, 349, 392, 440, 493,
        261, 294, 329, 349, 392, 440, 493,
        261, 294, 329, 349, 392, 440, 493,
        261, 294, 329, 349, 392, 440, 493 ]
]

noteLength = [
    [   1, 1, 1, 1, 1, 1, 2,
        1, 1, 1, 1, 1, 1, 2,
        1, 1, 1, 1, 1, 1, 2,
        1, 1, 1, 1, 1, 1, 2,
        1, 1, 1, 1, 1, 1, 2,
        1, 1, 1, 1, 1, 1, 2 ],
    [   1, 1, 2, 1, 1, 2,
        1, 1, 1, 1, 1, 1, 2,
        1, 1, 2, 1, 1, 2,
        1, 1, 1, 1, 1, 4 ],
    [   1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1 ]
]
"""

songTable = [
    [   261, 261, 392, 392, 440, 440, 392,
        349, 349, 330, 330, 294, 294, 261,
        392, 392, 349, 349, 330, 330, 294,
        392, 392, 349, 349, 330, 330, 294,
        261, 261, 392, 392, 440, 440, 392,
        349, 349, 330, 330, 294, 294, 261 ],
    [   261, 294, 329, 349, 392, 440, 493,
        261, 294, 329, 349, 392, 440, 493,
        261, 294, 329, 349, 392, 440, 493,
        261, 294, 329, 349, 392, 440, 493,
        261, 294, 329, 349, 392, 440, 493,
        261, 294, 329, 349, 392, 440, 493 ],
    [   493, 440, 392, 349, 329, 294, 261,
        493, 440, 392, 349, 329, 294, 261,
        493, 440, 392, 349, 329, 294, 261,
        493, 440, 392, 349, 329, 294, 261,
        493, 440, 392, 349, 329, 294, 261,
        493, 440, 392, 349, 329, 294, 261 ]
]

noteLength = [
    [   1, 1, 1, 1, 1, 1, 2,
        1, 1, 1, 1, 1, 1, 2,
        1, 1, 1, 1, 1, 1, 2,
        1, 1, 1, 1, 1, 1, 2,
        1, 1, 1, 1, 1, 1, 2,
        1, 1, 1, 1, 1, 1, 2 ],
    [   1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1 ],
    [   1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1 ]
]

signalLength = 42
waitTime = 0.25

# output formatter
formatter = lambda x: "%d" % x

# send the waveform table to K66F
serdev = '/dev/ttyACM0'
s = serial.Serial(serdev)

while (True):
    i = int(s.readline())
    print(i)
    print("Sending signal ...")
    print("It may take about %d seconds ..." % (2 * int(signalLength * waitTime)))
    for data in songTable[i]:
        s.write(bytes(formatter(data), 'UTF-8'))
        time.sleep(waitTime)
    for data in noteLength[i]:
        s.write(bytes(formatter(data), 'UTF-8'))
        time.sleep(waitTime)
    print("Signal sended")

s.close()